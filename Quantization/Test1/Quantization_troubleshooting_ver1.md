# ONNX λ¨λΈ μ–‘μν™” νΈλ¬λΈ”μν… λ¦¬ν¬νΈ

## π“‹ ν”„λ΅μ νΈ κ°μ”
- **λ©ν‘**: ν”„λ£¨λ‹λ YOLOv8 ONNX λ¨λΈμ INT8 μ–‘μν™”
- **μ›λ³Έ λ¨λΈ**: yolov8_custom_fixed_test7_pruned.onnx (10.58MB)
- **μµμΆ… κ²°κ³Ό**: μ •μ  μ–‘μν™” μ„±κ³µ, λ™μ  μ–‘μν™” μ‹¤ν¨

## π“ κ²°κ³Ό μ”μ•½

### μ„±λ¥ λΉ„κµ κ²°κ³Ό

| λ¨λΈ | ν¬κΈ°(MB) | μ¶”λ΅ μ‹κ°„(ms) | FPS | ν¬κΈ° κ°μ† | μ†λ„ λ³€ν™” |
|------|----------|-------------|-----|----------|----------|
| μ›λ³Έ | 10.58 | 7.88 | 127.0 | 0% | κΈ°μ¤€ |
| μ •μ  INT8 | 2.90 | 16.48 | 60.7 | -72.6% | -52.0% |

### μ–‘μν™” μ„±κ³Ό

| λ°©λ²• | κ²°κ³Ό | μ••μ¶•λΉ„μ¨ | μ†μ”μ‹κ°„ | μƒνƒ |
|------|------|----------|----------|------|
| λ™μ  μ–‘μν™” | μ‹¤ν¨ | - | - | β |
| μ •μ  μ–‘μν™” | μ„±κ³µ | 3.65λ°° | 2.53μ΄ | β… |

---

## β λ°μƒν• λ¬Έμ λ“¤

### 1μ°¨ λ¬Έμ : optimize_model νλΌλ―Έν„° μ¤λ¥
**μ¤λ¥ λ‚΄μ©:**
```
quantize_dynamic() got an unexpected keyword argument 'optimize_model'
```

**μ›μΈ:**
- μ‚¬μ© μ¤‘μΈ onnxruntime λ²„μ „μ—μ„ `optimize_model` νλΌλ―Έν„° λ―Έμ§€μ›
- μ½”λ“μ—μ„ λ²„μ „ νΈν™μ„±μ„ κ³ λ ¤ν•μ§€ μ•μ

**ν•΄κ²° λ°©λ²•:**
```python
# κΈ°μ΅΄ μ½”λ“
quantize_dynamic(
    model_input=str(self.original_model_path),
    model_output=str(output_path),
    weight_type=QuantType.QInt8,
    optimize_model=True,  # μ΄ λ¶€λ¶„ μ κ±°
    per_channel=False,
    reduce_range=False,
    extra_options={}
)

# μμ •λ μ½”λ“
quantize_dynamic(
    model_input=str(self.original_model_path),
    model_output=str(output_path),
    weight_type=QuantType.QInt8  # μµμ†ν•μ νλΌλ―Έν„°λ§ μ‚¬μ©
)
```

### 2μ°¨ λ¬Έμ : inferred.onnx νμΌ μ¤λ¥
**μ¤λ¥ λ‚΄μ©:**
```
[Errno 2] No such file or directory: 'yolov8_custom_fixed_test7_pruned-inferred.onnx'
```

**μ›μΈ:**
- onnxruntime μ–‘μν™” κ³Όμ •μ—μ„ μλ™ μƒμ„±λλ” μ„μ‹ νμΌμ„ μ°Ύμ§€ λ»ν•¨
- μ›λ³Έ νμΌλ…μ— νΉμλ¬Έμλ‚ κΈ΄ κ²½λ΅λ΅ μΈν• λ¬Έμ 

**ν•΄κ²° λ°©λ²•:**
```python
# μ„μ‹ νμΌ κ²½λ΅ (μ•μ „ν• μ΄λ¦„μΌλ΅)
temp_model_path = self.output_dir / "temp_model_for_quantization.onnx"
shutil.copy2(self.original_model_path, temp_model_path)

# μ •μ  μ–‘μν™” μν–‰
quantize_static(
    model_input=str(temp_model_path),  # μ„μ‹ νμΌ μ‚¬μ©
    model_output=str(output_path),
    calibration_data_reader=data_reader
)

# μ„μ‹ νμΌ μ κ±°
if temp_model_path.exists():
    temp_model_path.unlink()
```

### 3μ°¨ λ¬Έμ : λ™μ  μ–‘μν™” μ§€μ† μ‹¤ν¨
**μ¤λ¥ λ‚΄μ©:**
```
[Errno 2] No such file or directory: 'yolov8_custom_fixed_test7_pruned-inferred.onnx'
```

**μ›μΈ:**
- λ™μ  μ–‘μν™”μ—μ„λ„ λ™μΌν• μ„μ‹ νμΌ λ¬Έμ  λ°μƒ
- ν„μ¬ onnxruntime λ²„μ „κ³Ό YOLOv8 λ¨λΈ κµ¬μ΅° κ°„ νΈν™μ„± μ΄μ

**ν„μ¬ μƒνƒ:**
- ν•΄κ²° μ‹λ„ν–μΌλ‚ μ—¬μ „ν μ‹¤ν¨
- μ •μ  μ–‘μν™”λ” μ„μ‹ νμΌ λ³µμ‚¬ λ°©μ‹μΌλ΅ ν•΄κ²°λ¨

---

## β… ν•΄κ²° μ„±κ³Ό

### μ •μ  μ–‘μν™” μ„±κ³µ
**κµ¬ν„ μ‚¬ν•­:**
- Calibration λ°μ΄ν„°μ…‹ 100κ° μ΄λ―Έμ§€λ΅ μƒμ„±
- μ „μ²λ¦¬ νμ΄ν”„λΌμΈμ„ detecting_ver3.pyμ™€ λ™μΌν•κ² κµ¬μ„±
- μ„μ‹ νμΌ λ³µμ‚¬ λ°©μ‹μΌλ΅ κ²½λ΅ λ¬Έμ  ν•΄κ²°

**κ²°κ³Ό:**
- μ›λ³Έ: 10.58MB β†’ μ–‘μν™”: 2.90MB
- μ••μ¶• λΉ„μ¨: 3.65λ°°
- ν¬κΈ° κ°μ†: 72.6%
- μ²λ¦¬ μ‹κ°„: 2.53μ΄

### Calibration λ°μ΄ν„° μ²λ¦¬
**μ²λ¦¬ κ³Όμ •:**
1. μ΄λ―Έμ§€ λ””λ ‰ν† λ¦¬μ—μ„ 600κ° μ΄λ―Έμ§€ λ°κ²¬
2. 100κ° μ΄λ―Έμ§€ μ„ νƒν•μ—¬ μ „μ²λ¦¬
3. 320x192 ν•΄μƒλ„λ΅ λ¦¬μ‚¬μ΄μ¦ λ° ν¨λ”©
4. μ •κ·ν™” λ° ν…μ„ λ³€ν™ μ™„λ£

**μ „μ²λ¦¬ λ‹¨κ³„:**
- BGR β†’ RGB λ³€ν™
- λΉ„μ¨ μ μ§€ λ¦¬μ‚¬μ΄μ¦
- μ¤‘μ•™ μ •λ ¬ ν¨λ”© (114, 114, 114)
- [0, 1] μ •κ·ν™”
- HWC β†’ CHW μ°¨μ› λ³€ν™

---

## π“ μ„±λ¥ λ¶„μ„

### λ¨λΈ ν¬κΈ° μµμ ν™”
- **λ©ν‘ λ‹¬μ„±**: 72.6% ν¬κΈ° κ°μ†λ΅ λ©ν‘ λ‹¬μ„±
- **μ••μ¶• ν¨μ¨**: 3.65λ°° μ••μ¶•μΌλ΅ μ°μν• κ²°κ³Ό
- **λ©”λ¨λ¦¬ ν¨μ¨**: 7.68MB λ©”λ¨λ¦¬ μ‚¬μ©λ‰ κ°μ†

### μ¶”λ΅  μ†λ„ λ³€ν™”
- **μ†λ„ μ €ν•**: 127.0 FPS β†’ 60.7 FPS (52% κ°μ†)
- **μ›μΈ**: CPUμ—μ„ INT8 μ—°μ‚°μ΄ FP32λ³΄λ‹¤ λλ¦΄ μ μμ
- **μ‹¤μ©μ„±**: 60.7 FPSλ” μ‹¤μ‹κ°„ μ²λ¦¬μ— μ¶©λ¶„ν•¨

### νΈλ μ΄λ“μ¤ν”„ ν‰κ°€
- **μ¥μ **: λ¨λΈ ν¬κΈ° λ€ν­ κ°μ†, λ©”λ¨λ¦¬ ν¨μ¨μ„± ν–¥μƒ
- **λ‹¨μ **: μ¶”λ΅  μ†λ„ μ €ν•
- **μ μ© λ¶„μ•Ό**: λ°°ν¬ ν™κ²½μ—μ„ λ©”λ¨λ¦¬ μ μ•½μ΄ μ¤‘μ”ν• κ²½μ° μ λ¦¬

---

## π’΅ κΈ°μ μ  μΈμ‚¬μ΄νΈ

### μ–‘μν™” λ°©λ²•λ³„ νΉμ„±
1. **λ™μ  μ–‘μν™”**: Calibration λ¶ν•„μ”ν•μ§€λ§ ν„μ¬ λ¨λΈμ—μ„ νΈν™μ„± λ¬Έμ 
2. **μ •μ  μ–‘μν™”**: Calibration ν•„μ”ν•μ§€λ§ λ” μ•μ •μ μ΄κ³  λ†’μ€ μ••μ¶•λ¥ 

### onnxruntime λ²„μ „ μ΄μ
- μ‚¬μ© μ¤‘μΈ ν™κ²½μ—μ„ μΌλ¶€ νλΌλ―Έν„° λ―Έμ§€μ›
- μµμ†ν•μ ν•„μ νλΌλ―Έν„°λ§ μ‚¬μ©ν•λ” κ²ƒμ΄ μ•μ „ν•¨
- μ„μ‹ νμΌ μ²λ¦¬ λ°©μ‹μ΄ λ¨λΈμ— λ”°λΌ λ‹¤λ¦„

### YOLOv8 λ¨λΈ νΉμ„±
- ν”„λ£¨λ‹λ λ¨λΈλ„ μ–‘μν™” μ μ© κ°€λ¥
- λ³µμ΅ν• κµ¬μ΅°λ΅ μΈν•΄ μΌλ¶€ μ–‘μν™” λ°©λ²•μ—μ„ νΈν™μ„± λ¬Έμ  λ°μƒ
- Calibration λ°μ΄ν„° ν’μ§μ΄ μµμΆ… μ„±λ¥μ— μ¤‘μ”ν• μν–¥

---

## π”§ ν•΄κ²° λ°©λ²•λ΅ 

### μ μ§„μ  νλΌλ―Έν„° μ κ±°
1. μ „μ²΄ νλΌλ―Έν„°λ΅ μ‹μ‘ β†’ μ¤λ¥ λ°μƒ
2. λΉ„ν•„μ νλΌλ―Έν„° μ κ±° β†’ νΈν™μ„± ν™•λ³΄
3. μµμ† νλΌλ―Έν„° μ„ΈνΈ ν™•μ • β†’ μ•μ •μ„± λ‹¬μ„±

### μ„μ‹ νμΌ κ΄€λ¦¬
1. μ›λ³Έ νμΌ μ§μ ‘ μ‚¬μ© β†’ κ²½λ΅ λ¬Έμ  λ°μƒ
2. μ„μ‹ νμΌ λ³µμ‚¬ λ°©μ‹ β†’ λ¬Έμ  ν•΄κ²°
3. μ²λ¦¬ ν›„ μ •λ¦¬ β†’ λ””μ¤ν¬ κ³µκ°„ μ μ•½

### μ „μ²λ¦¬ νμ΄ν”„λΌμΈ μΌμΉ
1. κΈ°μ΅΄ detecting_ver3.pyμ™€ λ™μΌν• μ „μ²λ¦¬ μ μ©
2. ν•΄μƒλ„, ν¨λ”©, μ •κ·ν™” λ°©μ‹ ν†µμΌ
3. Calibration λ°μ΄ν„° ν’μ§ ν™•λ³΄

---

## π― ν„μ¬ μƒνƒ

### μ™„λ£λ μ‘μ—…
- [x] μ •μ  μ–‘μν™” κµ¬ν„ λ° μ„±κ³µ
- [x] Calibration λ°μ΄ν„°μ…‹ μƒμ„±
- [x] μ„±λ¥ λ²¤μΉλ§ν¬ μ™„λ£
- [x] μ–‘μν™” λ¨λΈ μƒμ„± (2.90MB)

### λ―Έμ™„λ£λ μ‘μ—…
- [ ] λ™μ  μ–‘μν™” νΈν™μ„± λ¬Έμ  ν•΄κ²°
- [ ] μ–‘μν™” λ¨λΈ μ •ν™•λ„ κ²€μ¦
- [ ] GPU ν™κ²½μ—μ„μ μ„±λ¥ ν…μ¤νΈ

### μƒμ„±λ νμΌ
- `quantized_models/model_static_int8.onnx`: 2.90MB (μ •μ  μ–‘μν™”)
- μ›λ³Έ λ¨λΈ λ€λΉ„ 72.6% ν¬κΈ° κ°μ† λ‹¬μ„±