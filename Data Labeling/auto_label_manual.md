# YOLOv8 자동 라벨링 → LabelMe 변환 코드 설명서

## 개요
이 코드는 YOLOv8 모델을 사용하여 이미지에서 객체를 감지하고, 그 결과를 LabelMe 형식의 JSON 파일로 변환하는 자동 라벨링 도구입니다. 하위 폴더를 포함한 모든 이미지를 재귀적으로 처리하고, 기존 라벨링을 건너뛰며, 신뢰도 임계값에 따라 객체를 필터링합니다.

## 주요 기능
1. 이미지 객체 감지 (YOLOv8 사용)
2. 감지 결과를 LabelMe JSON 형식으로 변환
3. 하위 폴더를 포함한 다수의 이미지 일괄 처리
4. 이미 처리된 파일 건너뛰기

## 실행 조건 및 설정

### 필수 조건
- YOLOv8 모델 파일 (`.pt`)
- 처리할 이미지 폴더(들)
- 필요 라이브러리: ultralytics, opencv-python, numpy

### 주요 매개변수
1. **`model_path`**: YOLOv8 모델 파일 경로
   - 예: `"C:\Users\KDT34\Desktop\Group 6\MNvision\yolov8m_custom.pt"`
   - 이 모델이 감지 성능과 클래스 정확도를 결정

2. **`image_dir`**: 처리할 이미지가 있는 디렉토리 경로
   - 예: `"C:\Users\KDT34\Desktop\Group 6\MNvision\2.Data\photo"`
   - 이 폴더와 모든 하위 폴더의 이미지를 재귀적으로 처리

3. **`output_base_dir`**: JSON 파일 저장 디렉토리
   - 기본값: `None` (이미지와 동일한 위치에 저장)
   - 다른 위치에 저장하려면 경로 지정

4. **`conf_threshold`**: 신뢰도 임계값
   - 기본값: `0.3` (30% 이상의 신뢰도를 가진 객체만 유지)
   - 값이 낮을수록 더 많은 객체를 감지하지만 부정확한 감지 증가
   - 값이 높을수록 정확도는 높아지지만 감지되는 객체 수 감소

## 처리 조건

### 이미지 선택 조건
- 확장자가 `.jpg`, `.jpeg`, `.png`인 파일만 처리
- 다른 확장자의 이미지는 무시됨

### 처리 건너뛰기 조건
- 이미 `auto_` 접두어가 붙은 JSON 파일이 존재하는 경우 해당 이미지는 건너뜀
- 예: 원본 이미지 이름이 `image01.jpg`인 경우, `auto_image01.json` 파일이 있으면 처리 건너뜀

### 객체 감지 조건
- YOLOv8 모델을 사용하여 각 이미지에서 객체 감지
- 신뢰도 임계값 이상의 객체만 라벨링에 포함
- 모델이 감지한 객체 클래스는 모델의 `names` 딕셔너리에서 가져옴

### JSON 파일 생성 조건
- 감지된 객체가 하나 이상 있는 경우에만 JSON 파일 생성
- 객체가 감지되지 않은 이미지는 JSON 파일이 생성되지 않음
- 생성된 JSON 파일에는 `auto_` 접두어가 붙음

## 예외 처리
- 이미지 로드나 객체 감지 중 오류 발생 시 해당 이미지를 건너뛰고 다음 이미지로 진행
- 오류 메시지는 콘솔에 출력되지만 프로그램은 계속 실행됨

## 출력 결과
1. **자동 라벨링 JSON 파일**:
   - 형식: `auto_{이미지파일명}.json`
   - 위치: 이미지와 동일한 폴더 또는 지정된 출력 폴더
   - 구조: LabelMe 호환 JSON 형식

2. **콘솔 출력**:
   - 총 이미지 파일 수
   - 처리 진행 상황 (10개 파일마다 업데이트)
   - 생성된 JSON 파일 경로
   - 객체가 감지되지 않은 이미지 경로
   - 오류 발생 메시지
   - 최종 처리 완료 메시지

## 주요 특징
- 이미지와 동일한 구조로 출력 디렉토리 유지 (상대 경로 보존)
- 자동 라벨링 시 원본 이미지 경로 보존 (JSON의 imagePath 필드)
- 각 객체의 신뢰도 점수 포함 (JSON의 confidence 필드)
- 자동 라벨링으로 생성되었음을 표시 (JSON의 auto_labeled 필드)

## 제한 사항
- YOLOv8 모델의 성능에 따라 객체 감지 정확도 제한
- 객체가 감지되지 않은 이미지에는 JSON 파일이 생성되지 않음
- GPU 가용성에 따라 처리 속도 차이 발생
- 메모리 사용량은 이미지 크기와 모델 크기에 영향을 받음